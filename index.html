<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content= "width=device-width, initial-scale=1.0"> 
    <title>Soar, Raven, Soar</title>
    <link href="style.css" rel="stylesheet"></head>
<body>

<header>
  <nav>
    <section>
      <a href="https://www.anderson.edu/admissions/visit/">Visit</a> 
      <a href="http://admissions.anderson.edu/apply">Apply</a>
    </section>
  </nav>
  
  <section>
    <img src="https://www.anderson.edu/wp-content/uploads/AU_logo_H_OBW-1.svg" alt="Anderson University" id="logo">
  </section>
</header>

<article>
  <section>
    <h1>Soar, Raven, Soar</h1>
    
    <span id=score></span>
    
    <canvas id="myCanvas" width="480" height="400"></canvas>

    Difficulty: <input name=difficulty value=1></input> <button id=restart>Restart</button>
    <button id=pause>Pause</button>
    <button id=step>Step</button>
    
    <footer>
      <span>Built with ❤️ using code from the <a href="https://developer.mozilla.org/en-US/docs/Games/Tutorials/2D_Breakout_game_pure_JavaScript">Mozilla Foundation</a> and MDN contributors.</span>
    </footer>
  </section>
</article>

<img style="display:none" id="raven" src="raven.png">

<script>
  var x, y, dx, dy, paddleX;
  var canvas = document.getElementById("myCanvas");
  var ctx = canvas.getContext("2d");
  var ballRadius = 12;
  var paddleHeight = 10;
  var paddleWidth = 75;
  var rightPressed = false;
  var leftPressed = false;
  var brickRowCount = 5;
  var brickColumnCount = 6;
  var brickWidth = 75;
  var brickHeight = 20;
  var brickPadding = 10;
  var brickOffsetTop = 30
  var brickOffsetLeft = 30;
  var color = "#f57920";
  var ravens_harmed = 0;
  var ravens_freed = 0;
  var paused = true;
  
  var bricks = [];

  restart()
  togglePause()

  document.addEventListener("keydown", keyDownHandler, false);
  document.addEventListener("keyup", keyUpHandler, false);
  document.addEventListener("mousemove", mouseMoveHandler, false);
  document.addEventListener("touchmove", mouseMoveHandler, false);

  document.querySelector('#restart').addEventListener('click', restart)
  document.querySelector('#pause').addEventListener('click', togglePause)

  function togglePause() {
    paused = !paused
    document.querySelector('#pause').innerHTML = paused ? 'Resume' : 'Pause'
    document.querySelector('#step').style.display = paused ? 'inline' : 'none'
    draw()
  }

  document.querySelector('#step').addEventListener('click', () => {
    if (paused) { draw() }
    console.clear()
    console.log(`x: ${x}\ndx: ${dx}\ny: ${y}\ndy: ${dy}`)
  })

  function restart() {
    let difficulty = eval(document.querySelector('input[name=difficulty]').value)
  
    x = canvas.width/2;
    y = canvas.height-30;
    dx = difficulty * Math.random();
    dy = -(difficulty * difficulty - dx * dx)
    paddleX = (canvas.width-paddleWidth)/2;

    for(var c=0; c<brickColumnCount; c++) {
      bricks[c] = [];
      for(var r=0; r<brickRowCount; r++) {
        bricks[c][r] = { x: 0, y: 0, status: 1 };
      }
    } 
  }

  function keyDownHandler(e) {
    if(e.keyCode == 39) {
      rightPressed = true;
    }
    else if(e.keyCode == 37) {
      leftPressed = true;
    }
  }
  function keyUpHandler(e) {
    if(e.keyCode == 39) {
      rightPressed = false;
    }
    else if(e.keyCode == 37) {
      leftPressed = false;
    }
  }
  function mouseMoveHandler(e) {
    if (e.targetTouches) { e = e.targetTouches[0] }
    
    var relativeX = (e.clientX - canvas.offsetLeft) * (canvas.width / canvas.offsetWidth);
    if(relativeX > 0 && relativeX < canvas.width) {
      paddleX = relativeX - paddleWidth/2;
    }
  }
  function collisionDetection() {
    for(var c=0; c<brickColumnCount; c++) {
      for(var r=0; r<brickRowCount; r++) {
        var b = bricks[c][r];
        if(b.status == 1) {
          if(x > b.x && x < b.x+brickWidth && y > b.y && y < b.y+brickHeight) {
            dy = -dy;
            b.status = 0;
          }
        }
      }
    }
  }

  function drawBall() {
    const raven = document.getElementById('raven');

    ctx.drawImage(raven, x - 38, y - 12);
  }
  function drawPaddle() {
    ctx.beginPath();
    ctx.rect(paddleX, canvas.height-paddleHeight, paddleWidth, paddleHeight);
    ctx.fillStyle = color;
    ctx.fill();
    ctx.closePath();
  }
  function drawBricks() {
    for(var c=0; c<brickColumnCount; c++) {
      for(var r=0; r<brickRowCount; r++) {
        if(bricks[c][r].status == 1) {
          var brickX = (r*(brickWidth+brickPadding))+brickOffsetLeft;
          var brickY = (c*(brickHeight+brickPadding))+brickOffsetTop;
          bricks[c][r].x = brickX;
          bricks[c][r].y = brickY;
          ctx.beginPath();
          ctx.rect(brickX, brickY, brickWidth, brickHeight);
          ctx.fillStyle = color;
          ctx.fill();
          ctx.closePath();
        }
      }
    }
  }
  function drawScore() {
    document.querySelector("#score").textContent = 'Ravens Freed: ' + ravens_freed + ' Ravens Harmed: ' + ravens_harmed 
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBricks();
    drawBall();
    drawPaddle();
    drawScore();
    collisionDetection();

    if(x + dx > canvas.width-ballRadius || x + dx < ballRadius) {
      dx = -dx;
    }
    if(y < -100) {
      ravens_freed++
      restart()
    }
    else if(y + dy > canvas.height-ballRadius) {
      if(x > paddleX && x < paddleX + paddleWidth) {
        dy = -dy;
      }
      else {
        ravens_harmed++
        restart()
      }
    }

    if(rightPressed && paddleX < canvas.width-paddleWidth) {
      paddleX += 7;
    }
    else if(leftPressed && paddleX > 0) {
      paddleX -= 7;
    }

    x += dx;
    y += dy;
    
    if (!paused) {
      requestAnimationFrame(draw);
    }
  }

  draw();
</script>

</body>
</html>